package com.innodealing.dao.jdbc.dm.bond.ccxe;

import java.util.Date;
import java.util.List;

import org.springframework.jdbc.core.BeanPropertyRowMapper;
import org.springframework.jdbc.core.RowMapper;
import org.springframework.stereotype.Component;

import com.innodealing.dao.jdbc.BaseDao;
import com.innodealing.model.dm.bond.asbrs.BondSecuFinaSheet;
import com.innodealing.util.DateUtils;

/**
 * @author kunkun.zhou
 * @date 2016年12月07日
 * @clasename BondSecuFinaSheetDao.java
 * @decription TODO
 */
@Component
public class BondTargetSecuFinaDao extends BaseDao<BondSecuFinaSheet> {
	private RowMapper rowMapper = new BeanPropertyRowMapper(BondSecuFinaSheet.class);
	
	public BondSecuFinaSheet getTargetData(Long comUniCode, Long bondUniCode, Date endDate) {
		String selResult = "a.TAFBBY_110101 as SBS101, "
				+ "a.TAFBBF_110115 as SBS101_1, "
				+ "a.TAFBBF_110601 as SBS102, "
				+ "a.TAFBBF_110701 as SBS102_1, "
				+ "a.TAFBBY_110401 as SBS103, "
				+ "a.TAFBBY_110501 as SBS104, "
				+ "a.TAFBBY_110701 as SBS105, "
				+ "a.TAFBBY_110801 as SBS106, "
				+ "a.TAFBBY_111701 as SBS107, "
				+ "a.TAFBBY_110601 as SBS108, "
				+ "a.TAFBBY_121601 as SBS109, "
				+ "a.TAFBBY_121701 as SBS110, "
				+ "a.TAFBBY_121117 as SBS111, "
				+ "a.TAFBBY_122327 as SBS113, "
				+ "a.TAFBBY_122801 as SBS114, "
				+ "a.TAFBBY_122901 as SBS114_1, "
				+ "a.TAFBBY_123701 as SBS115, "
				+ "a.TAFBBY_121901 as SBS112, "
				+ "a.TAFBBY_130000 as SBS116, "
				+ "a.TAFBB_100000 as SBS001, "
				+ "a.TAFBBY_210201 as SBS201, "
				+ "a.TAFBBY_210401 as SBS201_1, "
				+ "a.TAFBBY_210301 as SBS202, "
				+ "a.TAFBBY_210501 as SBS203, "
				+ "a.TAFBBY_210601 as SBS204, "
				+ "a.TAFBBY_210701 as SBS205, "
				+ "a.TAFBBF_212301 as SBS206, "
				+ "a.TAFBBF_212401 as SBS207, "
				+ "a.TAFBBY_213201 as SBS208, "
				+ "a.TAFBBY_213401 as SBS209, "
				+ "a.TAFBBY_211901 as SBS210, "
				+ "a.TAFBBY_220601 as SBS212, "
				+ "a.TAFBBY_220801 as SBS213, "
				+ "a.TAFBBY_230101 as SBS214, "
				+ "a.TAFBBY_213801 as SBS216, "
				+ "a.TAFBBY_240101 as SBS215, "
				+ "a.TAFBB_210000 as SBS002, "
				+ "a.TAFBBY_310201 as SBS301, "
				+ "a.TAFBBY_310301 as SBS302, "
				+ "a.TAFBBY_310703 as SBS302_2, "
				+ "a.TAFBBY_310401 as SBS303, "
				+ "a.TAFBBY_310701 as SBS305, "
				+ "a.TAFBBY_310601 as SBS304, "
				+ "a.TAFBBY_310801 as SBS306, "
				+ "a.TAFBBY_310101 as SBS310, "
				+ "a.TAFBBY_311201 as SBS307, "
				+ "a.TAFBBY_300000 as SBS003, "
				+ "a.TAFBBY_400000 as SBS004, "
				+ "b.TAFPBY_100000 as SPL100, "
				+ "b.TAFPBY_110301 as SPL101, "
				+ "b.TAFPBF_1110525 as SPL101_1, "
				+ "b.TAFPBF_110601 as SPL101_2, "
				+ "b.TAFPBF_110701 as SPL101_3, "
				+ "b.TAFPBY_110101 as SPL103, "
				+ "b.TAFPBY_110701 as SPL104, "
				+ "b.TAFPBY_110711 as SPL104_1, "
				+ "b.TAFPBY_110801 as SPL105, "
				+ "b.TAFPBY_111101 as SPL106, "
				+ "b.TAFPBY_111201 as SPL107, "
				+ "b.TAFPBY_200000 as SPL200, "
				+ "b.TAFPBF_201903 as SPL201, "
				+ "b.TAFPBF_200903 as SPL202, "
				+ "b.TAFPBF_201703 as SPL203, "
				+ "b.TAFPBF_201803 as SPL204, "
				+ "b.TAFPBY_300000 as SPL300, "
				+ "b.TAFPBY_310101 as SPL301, "
				+ "b.TAFPBY_310203 as SPL302, "
				+ "b.TAFPBY_400000 as SPL400,"
				+ "b.TAFPBY_410203 as SPL401,"
				+ "b.TAFPBY_500000 as SPL500,"
				+ "b.TAFPBY_510201 as SPL501,"
				+ "b.TAFPBY_510101 as SPL502,"
				+ "b.TAFPB_240801 as SPL503,"
				+ "b.TAFPB_240901 as SPL504,"
				+ "b.TAFPBY_510301 as SPL505,"
				+ "b.TAFPB_I_170101 as SPL506,"
				+ "b.TAFPB_170102 as SPL507,"
				+ "b.TAFPB_170103 as SPL508,"
				+ "c.TAFCBY_110048 as SCF101,"
				+ "c.TAFCBY_110049 as SCF106,"
				+ "c.TAFCBY_110009 as SCF102,"
				+ "c.TAFCBY_110008 as SCF103,"
				+ "c.TAFCBF_110020 as SCF104,"
				+ "c.TAFCBY_110401 as SCF105,"
				+ "c.TAFCBY_110000 as SCF100,"
				+ "c.TAFCBY_120301 as SCF202,"
				+ "c.TAFCBY_120401 as SCF203,"
				+ "c.TAFCBY_120501 as SCF204,"
				+ "c.TAFCBY_120000 as SCF200,"
				+ "c.TAFCBY_100000 as SCF001,"
				+ "c.TAFCBY_210101 as SCF301,"
				+ "c.TAFCBY_210301 as SCF304,"
				+ "c.TAFCBY_210401 as SCF303,"
				+ "c.TAFCBY_210000 as SCF300,"
				+ "c.TAFCBY_220201 as SCF401,"
				+ "c.TAFCBY_220101 as SCF402,"
				+ "c.TAFCBY_220301 as SCF403,"
				+ "c.TAFCBY_220000 as SCF400,"
				+ "c.TAFCBY_200000 as SCF002,"
				+ "c.TAFCBY_310301 as SCF501,"
				+ "c.TAFCBY_310201 as SCF502,"
				+ "c.TAFCBY_310501 as SCF503,"
				+ "c.TAFCBY_310000 as SCF500,"
				+ "c.TAFCBY_320101 as SCF601,"
				+ "c.TAFCBY_320301 as SCF602,"
				+ "c.TAFCBY_320701 as SCF603,"
				+ "c.TAFCBY_320000 as SCF600,"
				+ "c.TAFCBY_300000 as SCF003,"
				+ "c.TAFCBY_410101 as SCF004,"
				+ "c.TAFCBY_410201 as SCF005,"
				+ "c.TAFCBY_413201 as SCF006,"
				+ "c.TAFCBY_413301 as SCF007,"
				+ "c.TAFCBY_411001 as SCF901,"
				+ "c.TAFCBY_411401 as SCF902,"
				+ "c.TAFCBY_411501 as SCF903,"
				+ "c.TAFCBY_411601 as SCF904,"
				+ "c.TAFCBY_411701 as SCF905,"
				+ "c.TAFCBY_411801 as SCF906,"
				+ "c.TAFCBY_411901 as SCF907,"
				+ "c.TAFCBY_412001 as SCF908,"
				+ "c.TAFCBY_412101 as SCF909,"
				+ "c.TAFCBY_413501 as SCF910,"
				+ "c.TAFCBY_412201 as SCF911,"
				+ "c.TAFCBY_412301 as SCF912,"
				+ "c.TAFCBY_413601 as SCF913,"
				+ "c.TAFCBY_413701 as SCF914,"
				+ "c.TAFCBY_412601 as SCF915,"
				+ "c.TAFCBY_412701 as SCF916,"
				+ "c.TAFCBY_412801 as SCF917,"
				+ "c.TAFCBY_413001 as SCF918,"
				+ "c.TAFCBY_ADD_OPER_NETCASH as SCF919,"
				+ "c.TAFCBY_410501 as SCF920,"
				+ "c.TAFCBY_410801 as SCF921,"
				+ "c.TAFCBY_410802 as SCF922,"
				+ "c.TAFCBY_510101 as SCF923,"
				+ "c.TAFCBY_510201 as SCF924,"
				+ "c.TAFCBY_510301 as SCF925,"
				+ "c.TAFCBY_510401 as SCF926,"
				+ "c.TAFCBY_ADD_NETCASH as SCF927";
		
		String sql = "select a.COM_UNI_CODE,a.END_DATE,"+selResult
		+ " from D_BOND_FIN_FAL_BALA_TAFBB a "
		+ " left join D_BOND_FIN_FAL_PROF_TAFPB b on b.COM_UNI_CODE=a.COM_UNI_CODE and b.END_DATE=a.END_DATE and b.ISVALID=a.ISVALID and b.SHEET_MARK_PAR=a.SHEET_MARK_PAR "
		+ " left join D_BOND_FIN_FAL_CASH_TAFCB c on c.COM_UNI_CODE=a.COM_UNI_CODE and c.END_DATE=a.END_DATE and c.ISVALID=a.ISVALID and c.SHEET_MARK_PAR=a.SHEET_MARK_PAR "
		+ " where a.ISVALID='1' and a.SHEET_MARK_PAR='1' and a.COM_UNI_CODE=" + comUniCode + " and a.bond_uni_code=" + bondUniCode + " and a.END_DATE='" + DateUtils.convertDateToString(endDate) + "' limit 1";
		
		List<BondSecuFinaSheet> list = ccxeJdbcTemplate.query(sql.toString(), rowMapper);
		if (null == list || list.isEmpty()) {
			return null;
		}
		return list.get(0);
	}
	
	public List<BondSecuFinaSheet> getList(Integer start, Integer length) {
		String selResult = "a.TAFBBY_110101 as SBS101, "
				+ "a.TAFBBF_110115 as SBS101_1, "
				+ "a.TAFBBF_110601 as SBS102, "
				+ "a.TAFBBF_110701 as SBS102_1, "
				+ "a.TAFBBY_110401 as SBS103, "
				+ "a.TAFBBY_110501 as SBS104, "
				+ "a.TAFBBY_110701 as SBS105, "
				+ "a.TAFBBY_110801 as SBS106, "
				+ "a.TAFBBY_111701 as SBS107, "
				+ "a.TAFBBY_110601 as SBS108, "
				+ "a.TAFBBY_121601 as SBS109, "
				+ "a.TAFBBY_121701 as SBS110, "
				+ "a.TAFBBY_121117 as SBS111, "
				+ "a.TAFBBY_122327 as SBS113, "
				+ "a.TAFBBY_122801 as SBS114, "
				+ "a.TAFBBY_122901 as SBS114_1, "
				+ "a.TAFBBY_123701 as SBS115, "
				+ "a.TAFBBY_121901 as SBS112, "
				+ "a.TAFBBY_130000 as SBS116, "
				+ "a.TAFBB_100000 as SBS001, "
				+ "a.TAFBBY_210201 as SBS201, "
				+ "a.TAFBBY_210401 as SBS201_1, "
				+ "a.TAFBBY_210301 as SBS202, "
				+ "a.TAFBBY_210501 as SBS203, "
				+ "a.TAFBBY_210601 as SBS204, "
				+ "a.TAFBBY_210701 as SBS205, "
				+ "a.TAFBBF_212301 as SBS206, "
				+ "a.TAFBBF_212401 as SBS207, "
				+ "a.TAFBBY_213201 as SBS208, "
				+ "a.TAFBBY_213401 as SBS209, "
				+ "a.TAFBBY_211901 as SBS210, "
				+ "a.TAFBBY_220601 as SBS212, "
				+ "a.TAFBBY_220801 as SBS213, "
				+ "a.TAFBBY_230101 as SBS214, "
				+ "a.TAFBBY_213801 as SBS216, "
				+ "a.TAFBBY_240101 as SBS215, "
				+ "a.TAFBB_210000 as SBS002, "
				+ "a.TAFBBY_310201 as SBS301, "
				+ "a.TAFBBY_310301 as SBS302, "
				+ "a.TAFBBY_310703 as SBS302_2, "
				+ "a.TAFBBY_310401 as SBS303, "
				+ "a.TAFBBY_310701 as SBS305, "
				+ "a.TAFBBY_310601 as SBS304, "
				+ "a.TAFBBY_310801 as SBS306, "
				+ "a.TAFBBY_310101 as SBS310, "
				+ "a.TAFBBY_311201 as SBS307, "
				+ "a.TAFBBY_300000 as SBS003, "
				+ "a.TAFBBY_400000 as SBS004, "
				+ "b.TAFPBY_100000 as SPL100, "
				+ "b.TAFPBY_110301 as SPL101, "
				+ "b.TAFPBF_1110525 as SPL101_1, "
				+ "b.TAFPBF_110601 as SPL101_2, "
				+ "b.TAFPBF_110701 as SPL101_3, "
				+ "b.TAFPBY_110101 as SPL103, "
				+ "b.TAFPBY_110701 as SPL104, "
				+ "b.TAFPBY_110711 as SPL104_1, "
				+ "b.TAFPBY_110801 as SPL105, "
				+ "b.TAFPBY_111101 as SPL106, "
				+ "b.TAFPBY_111201 as SPL107, "
				+ "b.TAFPBY_200000 as SPL200, "
				+ "b.TAFPBF_201903 as SPL201, "
				+ "b.TAFPBF_200903 as SPL202, "
				+ "b.TAFPBF_201703 as SPL203, "
				+ "b.TAFPBF_201803 as SPL204, "
				+ "b.TAFPBY_300000 as SPL300, "
				+ "b.TAFPBY_310101 as SPL301, "
				+ "b.TAFPBY_310203 as SPL302, "
				+ "b.TAFPBY_400000 as SPL400,"
				+ "b.TAFPBY_410203 as SPL401,"
				+ "b.TAFPBY_500000 as SPL500,"
				+ "b.TAFPBY_510201 as SPL501,"
				+ "b.TAFPBY_510101 as SPL502,"
				+ "b.TAFPB_240801 as SPL503,"
				+ "b.TAFPB_240901 as SPL504,"
				+ "b.TAFPBY_510301 as SPL505,"
				+ "b.TAFPB_I_170101 as SPL506,"
				+ "b.TAFPB_170102 as SPL507,"
				+ "b.TAFPB_170103 as SPL508,"
				+ "c.TAFCBY_110048 as SCF101,"
				+ "c.TAFCBY_110049 as SCF106,"
				+ "c.TAFCBY_110009 as SCF102,"
				+ "c.TAFCBY_110008 as SCF103,"
				+ "c.TAFCBF_110020 as SCF104,"
				+ "c.TAFCBY_110401 as SCF105,"
				+ "c.TAFCBY_110000 as SCF100,"
				+ "c.TAFCBY_120301 as SCF202,"
				+ "c.TAFCBY_120401 as SCF203,"
				+ "c.TAFCBY_120501 as SCF204,"
				+ "c.TAFCBY_120000 as SCF200,"
				+ "c.TAFCBY_100000 as SCF001,"
				+ "c.TAFCBY_210101 as SCF301,"
				+ "c.TAFCBY_210301 as SCF304,"
				+ "c.TAFCBY_210401 as SCF303,"
				+ "c.TAFCBY_210000 as SCF300,"
				+ "c.TAFCBY_220201 as SCF401,"
				+ "c.TAFCBY_220101 as SCF402,"
				+ "c.TAFCBY_220301 as SCF403,"
				+ "c.TAFCBY_220000 as SCF400,"
				+ "c.TAFCBY_200000 as SCF002,"
				+ "c.TAFCBY_310301 as SCF501,"
				+ "c.TAFCBY_310201 as SCF502,"
				+ "c.TAFCBY_310501 as SCF503,"
				+ "c.TAFCBY_310000 as SCF500,"
				+ "c.TAFCBY_320101 as SCF601,"
				+ "c.TAFCBY_320301 as SCF602,"
				+ "c.TAFCBY_320701 as SCF603,"
				+ "c.TAFCBY_320000 as SCF600,"
				+ "c.TAFCBY_300000 as SCF003,"
				+ "c.TAFCBY_410101 as SCF004,"
				+ "c.TAFCBY_410201 as SCF005,"
				+ "c.TAFCBY_413201 as SCF006,"
				+ "c.TAFCBY_413301 as SCF007,"
				+ "c.TAFCBY_411001 as SCF901,"
				+ "c.TAFCBY_411401 as SCF902,"
				+ "c.TAFCBY_411501 as SCF903,"
				+ "c.TAFCBY_411601 as SCF904,"
				+ "c.TAFCBY_411701 as SCF905,"
				+ "c.TAFCBY_411801 as SCF906,"
				+ "c.TAFCBY_411901 as SCF907,"
				+ "c.TAFCBY_412001 as SCF908,"
				+ "c.TAFCBY_412101 as SCF909,"
				+ "c.TAFCBY_413501 as SCF910,"
				+ "c.TAFCBY_412201 as SCF911,"
				+ "c.TAFCBY_412301 as SCF912,"
				+ "c.TAFCBY_413601 as SCF913,"
				+ "c.TAFCBY_413701 as SCF914,"
				+ "c.TAFCBY_412601 as SCF915,"
				+ "c.TAFCBY_412701 as SCF916,"
				+ "c.TAFCBY_412801 as SCF917,"
				+ "c.TAFCBY_413001 as SCF918,"
				+ "c.TAFCBY_ADD_OPER_NETCASH as SCF919,"
				+ "c.TAFCBY_410501 as SCF920,"
				+ "c.TAFCBY_410801 as SCF921,"
				+ "c.TAFCBY_410802 as SCF922,"
				+ "c.TAFCBY_510101 as SCF923,"
				+ "c.TAFCBY_510201 as SCF924,"
				+ "c.TAFCBY_510301 as SCF925,"
				+ "c.TAFCBY_510401 as SCF926,"
				+ "c.TAFCBY_ADD_NETCASH as SCF927";
		
		String sql = "select a.COM_UNI_CODE,a.END_DATE,"+selResult
		+ " from TMP_BOND_FIN_FAL_BALA_TAFBB a "
		+ " left join TMP_BOND_FIN_FAL_PROF_TAFPB b on b.COM_UNI_CODE=a.COM_UNI_CODE and b.END_DATE=a.END_DATE "
		+ " left join TMP_BOND_FIN_FAL_CASH_TAFCB c on c.COM_UNI_CODE=a.COM_UNI_CODE and c.END_DATE=a.END_DATE "
		+ " order by a.com_uni_code,a.end_date limit "+start+"," + length;
				
		return ccxeJdbcTemplate.query(sql, rowMapper);
	}

	public Integer getAllCount() {
		StringBuilder sql = new StringBuilder();
		sql.append(" select count(1) from TMP_BOND_FIN_FAL_BALA_TAFBB a ")
		.append(" inner join TMP_BOND_FIN_FAL_PROF_TAFPB b on b.COM_UNI_CODE=a.COM_UNI_CODE and b.END_DATE=a.END_DATE ")
		.append(" left join TMP_BOND_FIN_FAL_CASH_TAFCB c on c.COM_UNI_CODE=a.COM_UNI_CODE and c.END_DATE=a.END_DATE ");
		return ccxeJdbcTemplate.queryForObject(sql.toString(), Integer.class);
	}
}
